import yfinance as yf
import pandas as pd

# Define the list of ticker symbols for multiple NSE stocks
ticker_symbols = [
 "3MINDIA.NS",
"ABB.NS",
"ACC.NS",
"AIAENG.NS",
"APLAPOLLO.NS",
"AUBANK.NS",
"ABBOTINDIA.NS",
"ADANIENSOL.NS",
"ADANIENT.NS",
"ADANIGREEN.NS",
"ADANIPORTS.NS",
"ADANIPOWER.NS",
"ATGL.NS",
"AWL.NS",
"ABCAPITAL.NS",
"ABFRL.NS",
"AJANTPHARM.NS",
"ALKEM.NS",
"AMBUJACEM.NS",
"APOLLOHOSP.NS",
"APOLLOTYRE.NS",
"ASHOKLEY.NS",
"ASIANPAINT.NS",
"ASTRAL.NS",
"AUROPHARMA.NS",
"DMART.NS",
"AXISBANK.NS",
"BSE.NS",
"BAJAJ-AUTO.NS",
"BAJFINANCE.NS",
"BAJAJFINSV.NS",
"BAJAJHLDNG.NS",
"BALKRISIND.NS",
"BANDHANBNK.NS",
"BANKBARODA.NS",
"BANKINDIA.NS",
"MAHABANK.NS",
"BAYERCROP.NS",
"BERGEPAINT.NS",
"BDL.NS",
"BEL.NS",
"BHARATFORG.NS",
"BHEL.NS",
"BPCL.NS",
"BHARTIARTL.NS",
"BHARTIHEXA.NS",
"BIOCON.NS",
"BOSCHLTD.NS",
"BRITANNIA.NS",
"CGPOWER.NS",
"CRISIL.NS",
"CANBK.NS",
"CARBORUNIV.NS",
"CHOLAFIN.NS",
"CIPLA.NS",
"COALINDIA.NS",
"COCHINSHIP.NS",
"COFORGE.NS",
"COLPAL.NS",
"CONCOR.NS",
"COROMANDEL.NS",
"CUMMINSIND.NS",
"DLF.NS",
"DABUR.NS",
"DALBHARAT.NS",
"DEEPAKNTR.NS",
"DELHIVERY.NS",
"DIVISLAB.NS",
"DIXON.NS",
"DRREDDY.NS",
"EICHERMOT.NS",
"EMAMILTD.NS",
"ENDURANCE.NS",
"ESCORTS.NS",
"EXIDEIND.NS",
"NYKAA.NS",
"FEDERALBNK.NS",
"FACT.NS",
"FORTIS.NS",
"GAIL.NS",
"GMRAIRPORT.NS",
"GICRE.NS",
"GLAND.NS",
"GLAXO.NS",
"MEDANTA.NS",
"GODREJCP.NS",
"GODREJIND.NS",
"GODREJPROP.NS",
"GRASIM.NS",
"GRINDWELL.NS",
"FLUOROCHEM.NS",
"GUJGASLTD.NS",
"HCLTECH.NS",
"HDFCAMC.NS",
"HDFCBANK.NS",
"HDFCLIFE.NS",
"HAVELLS.NS",
"HEROMOTOCO.NS",
"HINDALCO.NS",
"HAL.NS",
"HINDPETRO.NS",
"HINDUNILVR.NS",
"HINDZINC.NS",
"POWERINDIA.NS",
"HONAUT.NS",
"HUDCO.NS",
"ICICIBANK.NS",
"ICICIGI.NS",
"ICICIPRULI.NS",
"IDBI.NS",
"IDFCFIRSTB.NS",
"IRB.NS",
"ITC.NS",
"INDIANB.NS",
"INDHOTEL.NS",
"IOC.NS",
"IOB.NS",
"IRCTC.NS",
"IRFC.NS",
"IREDA.NS",
"IGL.NS",
"INDUSTOWER.NS",
"INDUSINDBK.NS",
"NAUKRI.NS",
"INFY.NS",
"INDIGO.NS",
"IPCALAB.NS",
"JKCEMENT.NS",
"JSWENERGY.NS",
"JSWINFRA.NS",
"JSWSTEEL.NS",
"JSL.NS",
"JINDALSTEL.NS",
"JIOFIN.NS",
"JUBLFOOD.NS",
"KPRMILL.NS",
"KEI.NS",
"KPITTECH.NS",
"KALYANKJIL.NS",
"KOTAKBANK.NS",
"LTF.NS",
"LTTS.NS",
"LICHSGFIN.NS",
"LTIM.NS",
"LT.NS",
"LICI.NS",
"LINDEINDIA.NS",
"LLOYDSME.NS",
"LUPIN.NS",
"MRF.NS",
"LODHA.NS",
"M&MFIN.NS",
"M&M.NS",
"MRPL.NS",
"MANKIND.NS",
"MARICO.NS",
"MARUTI.NS",
"MFSL.NS",
"MAXHEALTH.NS",
"MAZDOCK.NS",
"METROBRAND.NS",
"MSUMI.NS",
"MPHASIS.NS",
"MUTHOOTFIN.NS",
"NHPC.NS",
"NLCINDIA.NS",
"NMDC.NS",
"NTPC.NS",
"NESTLEIND.NS",
"NAM-INDIA.NS",
"OBEROIRLTY.NS",
"ONGC.NS",
"OIL.NS",
"PAYTM.NS",
"OFSS.NS",
"POLICYBZR.NS",
"PIIND.NS",
"PAGEIND.NS",
"PATANJALI.NS",
"PERSISTENT.NS",
"PETRONET.NS",
"PHOENIXLTD.NS",
"PIDILITIND.NS",
"POLYCAB.NS",
"POONAWALLA.NS",
"PFC.NS",
"POWERGRID.NS",
"PRESTIGE.NS",
"PGHH.NS",
"PNB.NS",
"RECLTD.NS",
"RVNL.NS",
"RELIANCE.NS",
"SBICARD.NS",
"SBILIFE.NS",
"SJVN.NS",
"SKFINDIA.NS",
"SRF.NS",
"MOTHERSON.NS",
"SCHAEFFLER.NS",
"SHREECEM.NS",
"SHRIRAMFIN.NS",
"SIEMENS.NS",
"SOLARINDS.NS",
"SONACOMS.NS",
"STARHEALTH.NS",
"SBIN.NS",
"SAIL.NS",
"SUNPHARMA.NS",
"SUNTV.NS",
"SUNDARMFIN.NS",
"SUNDRMFAST.NS",
"SUPREMEIND.NS",
"SUZLON.NS",
"SYNGENE.NS",
"TVSMOTOR.NS",
"TATACHEM.NS",
"TATACOMM.NS",
"TCS.NS",
"TATACONSUM.NS",
"TATAELXSI.NS",
"TATAINVEST.NS",
"TATAMOTORS.NS",
"TATAPOWER.NS",
"TATASTEEL.NS",
"TATATECH.NS",
"TECHM.NS",
"NIACL.NS",
"THERMAX.NS",
"TIMKEN.NS",
"TITAN.NS",
"TORNTPHARM.NS",
"TORNTPOWER.NS",
"TRENT.NS",
"TIINDIA.NS",
"UNOMINDA.NS",
"UPL.NS",
"ULTRACEMCO.NS",
"UNIONBANK.NS",
"UBL.NS",
"UNITDSPR.NS",
"VBL.NS",
"VEDL.NS",
"IDEA.NS",
"VOLTAS.NS",
"WIPRO.NS",
"YESBANK.NS",
"ZFCVINDIA.NS",
"ZOMATO.NS",
"ZYDUSLIFE.NS"
]

# Initialize a list to store DataFrames
data_frames = []

# Fetch data for each ticker symbol and store the close prices in the list
for ticker in ticker_symbols:
    try:
        data = yf.download(ticker, period="1y")
        close_prices = data[['Close']].rename(columns={'Close': ticker})
        data_frames.append(close_prices)
    except Exception as e:
        print(f"Unable to fetch data for {ticker}: {e}")
        # If unable to fetch data, create a DataFrame with 0 values
        dates = pd.date_range(end=pd.Timestamp.today(), periods=365)
        close_prices = pd.DataFrame({ticker: [0]*365}, index=dates)
        data_frames.append(close_prices)

# Concatenate all DataFrames along the columns
all_close_prices = pd.concat(data_frames, axis=1)

# Save the close prices to an Excel file
all_close_prices.to_excel("NSE_stocks_close_prices.xlsx")

print("Close prices for multiple NSE stocks for the last 1 year have been downloaded and saved to NSE_stocks_close_prices.xlsx")
